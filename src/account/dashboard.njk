---
layout: base.njk
title: "Member Dashboard"
memberArea: true
---

<div class="page-wrapper">
  <div class="dashboard-section">
    <div class="dashboard-content" data-ms-content="members">
      <h2 class="heading-50">Welcome <span data-ms-member="first-name">{$firstName}</span>!</h2>
      <h4 class="heading-40">Today&#x27;s Zoom Session Links:</h4>
      <div class="todays-offering">
        <div class="programs-collection-list-wrapper w-dyn-list">
          <div role="list" class="programs-collection-list w-dyn-items">
            {% for program in dashboardPrograms %}
            <div role="listitem" class="program-collection-item w-dyn-item">
              <div class="w-layout-grid programlistblock">
                {# Hidden element used by JS to filter programs by today's day #}
                <h1 class="day-filtering" style="display:none;">
                  {%- if program.dayFiltering -%}
                    {{ program.dayFiltering }}
                  {%- elif program.dayOfWeek -%}
                    {%- for day in program.dayOfWeek %}{{ day.name }}{% if not loop.last %}, {% endif %}{%- endfor -%}
                  {%- endif -%}
                </h1>
                <div class="dashboard-list-name-and-date-container">
                  <div class="name-day-and-time-block">
                    <div class="dashboard-title-container">
                      <h1 class="event-name">{{ program.name }}</h1>
                      <h1 class="event-name hide">:</h1>
                    </div>
                    <div class="dashboard-date-time-container">
                      <div class="text-block-46">{{ program.listingDayAndTimeText }}</div>
                    </div>
                  </div>
                  {% if program.dashboardEarlyArrivalMessage %}
                  <h1 class="presession-message">{{ program.dashboardEarlyArrivalMessage }}</h1>
                  {% endif %}
                  {% if program.dashboardSpecialAnnouncement %}
                  <div class="special-program-announcment">
                    <h1 class="special-announcment">{{ program.dashboardSpecialAnnouncement }}</h1>
                  </div>
                  {% endif %}
                </div>
                <div class="program-links">
                  <div class="program-links">
                    <a data-zoom="{{ program.zoomLink }}" data-name="{{ program.name }}" data-time="{{ program.listingDayAndTimeText }}" href="/account/waiting-room" class="attendance-button w-button">Join</a>
                  </div>
                </div>
              </div>
            </div>
            {% else %}
            <div class="w-dyn-empty">
              <div>No programs scheduled for today.</div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% block scripts %}
<!--  ============================================================  -->
<!--  ROOTED IN MINDFULNESS - DASHBOARD ZOOM LINK HANDLER         -->
<!--  This script filters programs by day and handles zoom links   -->
<!--  ============================================================  -->
<script>
document.addEventListener("DOMContentLoaded", function() {
    // ========================================
    // DAY FILTERING SECTION
    // Shows only programs that run today
    // ========================================
    function getMilwaukeeDay() {
        const date = new Date();
        return new Intl.DateTimeFormat('en-US', {
            timeZone: 'America/Chicago',
            weekday: 'long'
        }).format(date);
    }
    const currentDay = getMilwaukeeDay();
    const programItems = document.querySelectorAll('.programlistblock');

    programItems.forEach(item => {
        const itemDayElement = item.querySelector('.day-filtering');
        if (itemDayElement) {
            const itemDays = itemDayElement.textContent
                .split(",")
                .map(day => day.trim());
            if (!itemDays.includes(currentDay)) {
                item.closest('.program-collection-item').style.display = 'none';
            }
        }
    });

    // ========================================
    // ZOOM LINK REDIRECTION SECTION
    // ========================================
    const zoomButtons = document.querySelectorAll('a[href="/account/waiting-room"]');
    zoomButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            try {
                const programName = this.getAttribute('data-name') || 'Class';
                const eventTime = this.getAttribute('data-time') || '';
                const zoomLink = this.getAttribute('data-zoom') || '';
                if (!zoomLink.trim()) {
                    alert('Sorry, the zoom link is not available for this class. Please contact support.');
                    return;
                }
                const waitingRoomUrl = `/account/waiting-room?` +
                    `name=${encodeURIComponent(programName)}&` +
                    `time=${encodeURIComponent(eventTime)}&` +
                    `zoom=${encodeURIComponent(zoomLink)}`;
                window.location.href = waitingRoomUrl;
            } catch (error) {
                console.error('Error processing zoom link click:', error);
                alert('Sorry, there was an error accessing the waiting room. Please try again.');
            }
        });
    });
});
</script>
<!--  ============================================================  -->
<!--  END DASHBOARD ZOOM LINK HANDLER                              -->
<!--  ============================================================  -->
{% endblock %}
